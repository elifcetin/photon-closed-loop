#include "Filter.h"

static double filter_taps[FILTER_TAP_NUM] = {
  -0.0008367694015195704,
  0.0015380705470093405,
  -0.0008265107538075173,
  -0.0019756992222273086,
  0.00481153533427143,
  -0.00395392347130197,
  -0.0016156584129747534,
  0.0070577174839664926,
  -0.005183518587883736,
  -0.004835968380019591,
  0.013283246862869864,
  -0.008197970368517075,
  -0.009594714116696303,
  0.022114628011005843,
  -0.010725043276684646,
  -0.019775140905688136,
  0.0375721806158711,
  -0.013167951158080058,
  -0.04216908894809618,
  0.071130286633648,
  -0.014755596098357191,
  -0.12776541806368885,
  0.2820375988198952,
  0.6513139343062366,
  0.2820375988198952,
  -0.12776541806368885,
  -0.014755596098357191,
  0.071130286633648,
  -0.04216908894809618,
  -0.013167951158080058,
  0.0375721806158711,
  -0.019775140905688136,
  -0.010725043276684646,
  0.022114628011005843,
  -0.009594714116696303,
  -0.008197970368517075,
  0.013283246862869864,
  -0.004835968380019591,
  -0.005183518587883736,
  0.0070577174839664926,
  -0.0016156584129747534,
  -0.00395392347130197,
  0.00481153533427143,
  -0.0019756992222273086,
  -0.0008265107538075173,
  0.0015380705470093405,
  -0.0008367694015195704
};

void Filter_init(Filter* f) {
  int i;
  for(i = 0; i < FILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void Filter_put(Filter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == FILTER_TAP_NUM)
    f->last_index = 0;
}

double Filter_get(Filter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < FILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : FILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
